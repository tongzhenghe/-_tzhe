<?php// +----------------------------------------------------------------------// | ThinkPHP [ WE CAN DO IT JUST THINK ]// +----------------------------------------------------------------------// | Copyright (c) 2006-2016 http://thinkphp.cn All rights reserved.// +----------------------------------------------------------------------// | Licensed ( http://www.apache.org/licenses/LICENSE-2.0 )// +----------------------------------------------------------------------// | Author: 流年 <liu21st@gmail.com>// +----------------------------------------------------------------------// 应用公共文件use Qiniu\Auth;function wl_debug( $value ){    echo '<pre>';    print_r( $value );    echo '<pre>';    exit;}function  wl_debug_log( $files  , $key  = '' ){    $files = [$key ? $key : date('Y-m-d H : s', time()) => $files];    $dir = fopen("../application/index/error.txt", "w") or die("Unable to open file!");    fwrite($dir,  print_r($files, true ) );    fclose($dir);}function jsondebug( $array ){    if (is_array($array)) {        exit(json_encode(['json' => $array]));    }    exit( json_encode(['str' => $array]) );}function iJson( $url = null , $code = 200,  $status = true, $msg = '提交成功'){    $data = [        'url' => $url,        'code' =>$code,        'status' =>  $status,        'msg' => $msg,    ];    $json =  json_encode($data);    return $json;}/** * @return string */function gip() {    //strcasecmp 比较两个字符，不区分大小写。返回0，>0，<0。    if(getenv('HTTP_CLIENT_IP') && strcasecmp(getenv('HTTP_CLIENT_IP'), 'unknown')) {        $ip = getenv('HTTP_CLIENT_IP');    } elseif(getenv('HTTP_X_FORWARDED_FOR') && strcasecmp(getenv('HTTP_X_FORWARDED_FOR'), 'unknown')) {        $ip = getenv('HTTP_X_FORWARDED_FOR');    } elseif(getenv('REMOTE_ADDR') && strcasecmp(getenv('REMOTE_ADDR'), 'unknown')) {        $ip = getenv('REMOTE_ADDR');    } elseif(isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], 'unknown')) {        $ip = $_SERVER['REMOTE_ADDR'];    }    $res =  preg_match ( '/[\d\.]{7,15}/', $ip, $matches ) ? $matches [0] : '';    return  $res;}function is_md5($password) {    return preg_match("/^[a-z0-9]{32}$/", $password);}/** * 取汉字的第一个字的首字母 * @param type $str * @return string|null */ function _getFirstCharter($str) {     if (empty($str)) {         return '';     }     $fchar = ord($str{0});     if ($fchar >= ord('A') && $fchar <= ord('z')) return strtoupper($str{0});     $s1 = iconv('UTF-8', 'gb2312', $str);     $s2 = iconv('gb2312', 'UTF-8', $s1);     $s = $s2 == $str ? $s1 : $str;     $asc = ord($s{0}) * 256 + ord($s{1}) - 65536;     if ($asc >= -20319 && $asc <= -20284) return 'A';     if ($asc >= -20283 && $asc <= -19776) return 'B';     if ($asc >= -19775 && $asc <= -19219) return 'C';     if ($asc >= -19218 && $asc <= -18711) return 'D';     if ($asc >= -18710 && $asc <= -18527) return 'E';     if ($asc >= -18526 && $asc <= -18240) return 'F';     if ($asc >= -18239 && $asc <= -17923) return 'G';     if ($asc >= -17922 && $asc <= -17418) return 'H';     if ($asc >= -17417 && $asc <= -16475) return 'J';     if ($asc >= -16474 && $asc <= -16213) return 'K';     if ($asc >= -16212 && $asc <= -15641) return 'L';     if ($asc >= -15640 && $asc <= -15166) return 'M';     if ($asc >= -15165 && $asc <= -14923) return 'N';     if ($asc >= -14922 && $asc <= -14915) return 'O';     if ($asc >= -14914 && $asc <= -14631) return 'P';     if ($asc >= -14630 && $asc <= -14150) return 'Q';     if ($asc >= -14149 && $asc <= -14091) return 'R';     if ($asc >= -14090 && $asc <= -13319) return 'S';     if ($asc >= -13318 && $asc <= -12839) return 'T';     if ($asc >= -12838 && $asc <= -12557) return 'W';     if ($asc >= -12556 && $asc <= -11848) return 'X';     if ($asc >= -11847 && $asc <= -11056) return 'Y';     if ($asc >= -11055 && $asc <= -10247) return 'Z';     return null; }function rand_captcha() {    $key =   rand(1111, 9999);   return $key;}function ErrorJson( $msg ){    if (empty($msg)) return false;    $code = 400;    return json_encode(['code' => $code, 'msg' =>$msg]);}/** * @param $data * @param int $parent_id * @return array */function _reSort($data, $parent_id = 0){    $return = [];//不能用static    foreach($data as $v) {        if($v['pid'] == $parent_id) {            foreach($data as $subv) {                if($subv['pid'] == $v['id']) {                    $v['children'] = _reSort($data, $v['id']);                    break;                }            }            $return[] = $v;        }    }    return $return;}function tree($data, $pid = 0, $deep = 0 ){    static $arr = [];    foreach ($data as $val) {        if ($val['pid'] == $pid ) {            $val['deep'] = $deep;            $val['html'] = str_repeat('|—',$deep);            $arr[] = $val;            $arr = tree($data, $val['id'], $deep+1 );        }    }    return $arr;}function utf8_sub_str( $text, $statr = 0, $end = 10 ){    if (empty($text) ) return false;    return mb_substr($text, $statr, $end, 'utf-8');}function timeTran($time){    $t = time() - $time;    $f = array(        '31536000' => '年',        '2592000' => '个月',        '604800' => '星期',        '86400' => '天',        '3600' => '小时',        '60' => '分钟',        '1' => '秒'    );    foreach ($f as $k => $v) {        if (0 != $c = floor($t / (int)$k)) {            return $c . $v  .'前';        }    }}